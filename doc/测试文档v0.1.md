# 数据管理平台 - 测试文档

## 文档信息
| 项          | 内容                          |
|-------------|-------------------------------|
| 文档版本    | V0.2                          |
| 关联需求    | 需求说明v0.2                  |
| 关联架构    | 架构设计文档v0.2              |

## 一、测试策略

### 1.1 测试范围
覆盖系统全部功能模块：用户认证、用户管理、模板管理、表单数据管理、系统管理。

### 1.2 测试方法
- 后端：使用 pytest 进行接口自动化测试
- 前端：Playwright E2E 自动化测试 + 手工测试
- 压力测试：使用 Python 多线程并发请求测试 API 性能

### 1.3 测试环境
- 后端：Flask 测试客户端 + 独立SQLite测试数据库
- 前端：Chromium（Playwright headless）+ Chrome 90+ 浏览器
- 测试数据：每次测试前初始化，测试后清理

## 二、后端接口测试用例

### 2.1 用户认证模块

| 编号 | 用例名称 | 接口 | 前置条件 | 测试步骤 | 预期结果 |
|------|---------|------|---------|---------|---------|
| AUTH-01 | 正常登录 | POST /api/auth/login | 存在admin/admin123账号 | 提交正确用户名密码 | code=200，返回token和用户信息 |
| AUTH-02 | 密码错误 | POST /api/auth/login/ | 存在admin账号 | 提交错误密码 | code=400，msg="用户名或密码错误" |
| AUTH-03 | 用户不存在 | POST /api/auth/login/ | 无 | 提交不存在的用户名 | code=400，msg="用户名或密码错误" |
| AUTH-04 | 禁用用户登录 | POST /api/auth/login/ | 用户status=0 | 提交正确用户名密码 | code=403，提示账号已禁用 |
| AUTH-05 | 登录记录日志 | POST /api/auth/login/ | 无 | 登录成功或失败 | login_log表新增一条记录 |
| AUTH-06 | 正常登出 | POST /api/auth/logout/ | 已登录 | 携带Token请求登出 | code=200 |
| AUTH-07 | 获取用户信息 | GET /api/auth/user/info/ | 已登录 | 携带Token请求 | code=200，返回当前用户信息 |
| AUTH-08 | 无Token访问 | GET /api/auth/user/info/ | 未登录 | 不携带Token请求 | code=401 |
| AUTH-09 | 过期Token访问 | GET /api/auth/user/info/ | Token已过期 | 携带过期Token请求 | code=401 |
| AUTH-10 | 修改密码-正常 | POST /api/auth/password/change/ | 已登录 | 提交正确旧密码和合规新密码 | code=200，密码修改成功 |
| AUTH-11 | 修改密码-旧密码错误 | POST /api/auth/password/change/ | 已登录 | 提交错误旧密码 | code=400，提示旧密码错误 |
| AUTH-12 | 修改密码-新密码不合规 | POST /api/auth/password/change/ | 已登录 | 新密码少于6位或纯数字 | code=400，提示密码格式不符 |
| AUTH-13 | 修改密码-确认不一致 | POST /api/auth/password/change/ | 已登录 | new_pwd与confirm_pwd不同 | code=400，提示两次密码不一致 |
| AUTH-14 | 首次登录标识 | POST /api/auth/login/ | need_change_pwd=1 | 登录成功 | 返回数据包含need_change_pwd=1 |

### 2.2 用户管理模块

| 编号 | 用例名称 | 接口 | 前置条件 | 测试步骤 | 预期结果 |
|------|---------|------|---------|---------|---------|
| USER-01 | admin新增用户 | POST /api/users/ | admin登录 | 提交用户名、角色 | code=200，用户创建成功 |
| USER-02 | user新增用户 | POST /api/users/ | user登录 | 提交用户名、角色 | code=403，权限不足 |
| USER-03 | 用户名重复 | POST /api/users/ | admin登录，用户名已存在 | 提交重复用户名 | code=400，提示用户名已存在 |
| USER-04 | 查询用户列表 | GET /api/users/ | admin登录 | 请求用户列表 | code=200，返回用户数组 |
| USER-05 | user查询用户列表 | GET /api/users/ | user登录 | 请求用户列表 | code=403，权限不足 |
| USER-06 | 修改用户 | PUT /api/users/{id}/ | admin登录 | 修改用户角色 | code=200，修改成功 |
| USER-07 | 删除用户 | DELETE /api/users/{id}/ | admin登录 | 删除普通用户 | code=200，删除成功 |
| USER-08 | 删除自己 | DELETE /api/users/{id}/ | admin登录 | 删除自己的账号 | code=400，不允许删除自己 |
| USER-09 | 重置密码 | POST /api/users/{id}/reset-pwd/ | admin登录 | 重置用户密码 | code=200，密码重置为123456 |

### 2.3 模板管理模块

| 编号 | 用例名称 | 接口 | 前置条件 | 测试步骤 | 预期结果 |
|------|---------|------|---------|---------|---------|
| TPL-01 | admin新增模板 | POST /api/templates/ | admin登录 | 提交模板名称和字段配置 | code=200，创建成功 |
| TPL-02 | user新增模板 | POST /api/templates/ | user登录 | 提交模板名称和字段配置 | code=403，权限不足 |
| TPL-03 | 模板名称重复 | POST /api/templates/ | admin登录，名称已存在 | 提交重复名称 | code=400，提示名称已存在 |
| TPL-04 | 查询模板列表 | GET /api/templates/ | 已登录 | 请求模板列表 | code=200，返回分页数据 |
| TPL-05 | 模糊搜索模板 | GET /api/templates/?name=员工 | 已登录 | 按名称搜索 | code=200，返回匹配结果 |
| TPL-06 | 查询模板详情 | GET /api/templates/{id}/ | 已登录 | 请求模板详情 | code=200，返回完整模板信息 |
| TPL-07 | admin修改模板 | PUT /api/templates/{id}/ | admin登录 | 修改模板名称和字段 | code=200，修改成功 |
| TPL-08 | user修改模板 | PUT /api/templates/{id}/ | user登录 | 修改模板 | code=403，权限不足 |
| TPL-09 | 删除无关联数据模板 | DELETE /api/templates/{id}/ | admin登录，模板无关联数据 | 删除模板 | code=200，删除成功 |
| TPL-10 | 删除有关联数据模板 | DELETE /api/templates/{id}/ | admin登录，模板有关联数据 | 删除模板 | code=400，提示存在关联数据 |
| TPL-11 | 分页查询 | GET /api/templates/?page=2&page_size=5 | 已登录，存在多条模板 | 请求第2页 | code=200，返回正确分页数据 |

### 2.4 表单数据模块

| 编号 | 用例名称 | 接口 | 前置条件 | 测试步骤 | 预期结果 |
|------|---------|------|---------|---------|---------|
| FORM-01 | 新增表单数据 | POST /api/forms/ | 已登录，模板存在 | 提交表单数据 | code=200，自动关联当前用户 |
| FORM-02 | 必填项校验 | POST /api/forms/ | 已登录 | 缺少必填字段 | code=400，提示必填项 |
| FORM-03 | admin查询全部数据 | GET /api/forms/ | admin登录 | 查询某模板数据 | code=200，返回所有用户数据 |
| FORM-04 | user仅查看自己数据 | GET /api/forms/ | user登录 | 查询某模板数据 | code=200，仅返回自己的数据 |
| FORM-05 | 关键字搜索 | GET /api/forms/?keyword=张三 | 已登录 | 按关键字搜索 | code=200，返回匹配结果 |
| FORM-06 | 修改自己的数据 | PUT /api/forms/{id}/ | user登录，数据属于自己 | 修改数据 | code=200，修改成功 |
| FORM-07 | user修改他人数据 | PUT /api/forms/{id}/ | user登录，数据属于他人 | 修改数据 | code=403，权限不足 |
| FORM-08 | admin修改任意数据 | PUT /api/forms/{id}/ | admin登录 | 修改他人数据 | code=200，修改成功 |
| FORM-09 | 删除自己的数据 | DELETE /api/forms/{id}/ | user登录，数据属于自己 | 删除数据 | code=200，删除成功 |
| FORM-10 | user删除他人数据 | DELETE /api/forms/{id}/ | user登录，数据属于他人 | 删除数据 | code=403，权限不足 |
| FORM-11 | 查询数据详情 | GET /api/forms/{id}/ | 已登录 | 查询数据详情 | code=200，返回完整数据 |

### 2.5 系统日志模块

| 编号 | 用例名称 | 接口 | 前置条件 | 测试步骤 | 预期结果 |
|------|---------|------|---------|---------|---------|
| LOG-01 | admin查询日志 | GET /api/logs/login/ | admin登录 | 查询登录日志 | code=200，返回分页日志 |
| LOG-02 | user查询日志 | GET /api/logs/login/ | user登录 | 查询登录日志 | code=403，权限不足 |
| LOG-03 | 日志分页 | GET /api/logs/login/?page=1&page_size=10 | admin登录 | 分页查询 | code=200，返回正确分页数据 |

## 三、前端页面测试用例

### 3.1 登录页

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-LOGIN-01 | 正常登录跳转 | 输入正确账号密码，点击登录 | 跳转至首页，显示欢迎语 |
| FE-LOGIN-02 | 登录失败提示 | 输入错误密码，点击登录 | 显示红色错误提示 |
| FE-LOGIN-03 | 记住密码 | 勾选记住密码后登录，退出后重新打开 | 用户名自动填充 |
| FE-LOGIN-04 | 防重复提交 | 点击登录按钮 | 按钮禁用，防止重复点击 |
| FE-LOGIN-05 | 首次登录改密 | 使用need_change_pwd=1的账号登录 | 自动跳转至个人中心修改密码 |

### 3.2 权限控制

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-PERM-01 | user不可见管理菜单 | user登录后查看侧边栏 | 不显示用户管理、系统日志菜单 |
| FE-PERM-02 | user不可见模板操作按钮 | user登录后进入模板管理 | 不显示新增、编辑、删除按钮 |
| FE-PERM-03 | user直接访问admin路由 | user在地址栏输入/system/users | 跳转至401页面 |
| FE-PERM-04 | 未登录访问 | 清除Token后访问任意页面 | 跳转至登录页 |

### 3.3 模板管理页

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-TPL-01 | 新增模板 | 点击新增，填写名称和字段配置，提交 | 列表新增一条模板 |
| FE-TPL-02 | 字段类型切换 | 新增字段时切换类型为radio | 显示选项配置输入框 |
| FE-TPL-03 | 搜索模板 | 输入关键字搜索 | 列表过滤显示匹配结果 |
| FE-TPL-04 | 删除有数据模板 | 删除关联了表单数据的模板 | 弹出提示，禁止删除 |

### 3.4 表单数据页

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-FORM-01 | 动态表单渲染 | 选择模板后点击新增 | 弹窗按模板字段动态渲染表单 |
| FE-FORM-02 | 必填校验 | 不填必填项直接提交 | 显示校验错误提示 |
| FE-FORM-03 | 编辑数据回显 | 点击编辑已有数据 | 表单回显原有数据 |
| FE-FORM-04 | 分页切换 | 数据超过一页时切换页码 | 正确加载对应页数据 |

### 3.5 系统管理页

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-SYS-01 | 修改密码 | 在个人中心填写旧密码和新密码提交 | 提示修改成功 |
| FE-SYS-02 | 新增用户 | admin在用户管理页新增用户 | 列表新增一条用户 |
| FE-SYS-03 | 重置密码 | admin点击重置密码 | 提示密码已重置为123456 |
| FE-SYS-04 | 查看登录日志 | admin进入系统日志页 | 显示登录日志列表 |

### 3.6 数据查询页

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-BROWSER-01 | 模板选择加载数据 | 选择模板 | 表格加载该模板的数据 |
| FE-BROWSER-02 | 添加筛选条件 | 添加筛选条件并查询 | 表格按条件过滤数据 |
| FE-BROWSER-03 | 列排序 | 点击列头 | 数据按该列升序/降序排列 |
| FE-BROWSER-04 | 列拖拽排序 | 拖拽列头到新位置 | 列顺序调整 |
| FE-BROWSER-05 | 隐藏/恢复列 | 点击列头隐藏按钮 | 列隐藏，可通过下拉菜单恢复 |
| FE-BROWSER-06 | 导出Excel | 点击导出Excel按钮 | 下载xlsx文件，内容与当前筛选结果一致 |

### 3.7 表格编辑页

| 编号 | 用例名称 | 测试步骤 | 预期结果 |
|------|---------|---------|---------|
| FE-SHEET-01 | 表格加载 | 选择模板 | 以表格形式展示数据 |
| FE-SHEET-02 | 单元格编辑 | 点击单元格编辑数据 | 数据保存成功 |

## 四、E2E 自动化测试（Playwright）

测试脚本：`test_webapp.py`

| 编号 | 用例名称 | 测试内容 | 预期结果 |
|------|---------|---------|---------|
| E2E-01 | 登录页渲染 | 访问/login，检查页面元素 | 显示"数据管理平台"标题、用户名/密码输入框、登录按钮 |
| E2E-02 | 空字段校验 | 不填写直接点击登录 | 显示表单验证错误 |
| E2E-03 | 错误密码 | 输入错误密码登录 | 停留在登录页 |
| E2E-04 | 成功登录 | 输入正确账号密码 | 跳转到首页，显示欢迎信息 |
| E2E-05 | 侧边栏导航 | 检查所有菜单项 | 8个菜单项可见，点击可跳转 |
| E2E-06 | 模板管理页 | 导航到模板管理 | 显示搜索框、新增按钮、数据表格 |
| E2E-07 | 新增模板弹窗 | 点击新增模板 | 弹窗显示，标题为"新增模板" |
| E2E-08 | 表单数据页 | 导航到表单数据 | 显示表格和填写表单按钮 |
| E2E-09 | 数据查询页 | 导航到数据查询 | 页面正常加载 |
| E2E-10 | 表格编辑页 | 导航到表格编辑 | 页面正常加载 |
| E2E-11 | 用户管理页 | 导航到用户管理 | 显示表格、新增按钮、admin用户 |
| E2E-12 | 系统日志页 | 导航到系统日志 | 显示日志表格 |
| E2E-13 | 个人中心页 | 导航到个人中心 | 显示用户信息和修改密码表单 |
| E2E-14 | 退出登录 | 点击退出登录 | 跳转到登录页 |
| E2E-15 | 未认证重定向 | 未登录访问/home | 重定向到登录页 |

## 五、压力测试

测试脚本：`test_stress.py`（20并发用户，每场景100请求）

| 测试场景 | API | 关注指标 |
|---------|-----|---------|
| 登录（正确密码） | POST /api/auth/login | 吞吐量、P95延迟、成功率 |
| 登录（错误密码） | POST /api/auth/login | 吞吐量、P95延迟 |
| 获取用户信息 | GET /api/auth/userinfo | 吞吐量、P95延迟 |
| 查询模板列表 | GET /api/templates | 吞吐量、P95延迟 |
| 查询表单数据 | GET /api/forms | 吞吐量、P95延迟 |
| 查询用户列表 | GET /api/users | 吞吐量、P95延迟 |
| 查询系统日志 | GET /api/logs | 吞吐量、P95延迟 |
| 创建模板 | POST /api/templates | 吞吐量、SQLite锁冲突率 |
| 创建表单数据 | POST /api/forms | 吞吐量、SQLite锁冲突率 |
| 混合读操作 | GET 多接口混合 | 综合吞吐量、P95延迟 |

已知限制：SQLite 在高并发写入时存在 `database is locked` 错误，建议生产环境开启 WAL 模式或迁移至 PostgreSQL/MySQL。
